<!-- index.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Student Group Lookup</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f2f5;
    }
    #search-container {
      text-align: center;
      padding: 40px;
      border-radius: 8px;
      background-color: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      width: 320px;
    }
    #current-date {
      margin-bottom: 25px;
      color: #555;
      font-size: 16px;
      border-bottom: 1px solid #eee;
      padding-bottom: 15px;
    }
    #rollInput {
      padding: 10px;
      font-size: 16px;
      width: calc(70% - 22px); /* Adjust for padding and border */
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #007bff;
      background-color: #007bff;
      color: white;
      border-radius: 4px;
      transition: background-color 0.2s, border-color 0.2s;
    }
    button:hover:not(:disabled) {
      background-color: #0056b3;
      border-color: #0056b3;
    }
    button:disabled {
      background-color: #ccc;
      border-color: #ccc;
      cursor: not-allowed;
    }
    #result {
      margin-top: 20px;
      font-size: 18px;
      min-height: 27px; /* Prevents layout shift when text appears */
      color: #333;
    }
  </style>
</head>
<body>
  <div id="search-container">
    <h2>Student Group Lookup</h2>
    <p id="current-date"></p>
    <input type="text" id="rollInput" placeholder="Loading group data..." disabled />
    <button id="searchButton" onclick="lookupGroup()" disabled>Search</button>
    <p id="result"></p>
  </div>

  <script>
    let groupData = null; // This will hold the data from group-data.json

    document.addEventListener("DOMContentLoaded", () => {
      const rollInputElement = document.getElementById("rollInput");
      const searchButton = document.getElementById("searchButton");
      const resultElement = document.getElementById("result");
      const dateElement = document.getElementById("current-date");

      // --- Date Grabber ---
      // Get today's date and format it into a readable string.
      const today = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      dateElement.textContent = `Today is ${today.toLocaleDateString('en-US', options)}`;

      fetch('group-data.json')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          groupData = data;
          rollInputElement.placeholder = "Enter Roll No. or Group";
          rollInputElement.disabled = false;
          searchButton.disabled = false;
        })
        .catch(error => {
          console.error("Error loading group data:", error);
          resultElement.textContent = "Failed to load group data. Please refresh.";
          rollInputElement.placeholder = "Error";
        });

      rollInputElement.addEventListener("keyup", function(event) {
        if (event.key === "Enter") {
          lookupGroup();
        }
      });
    });

    function lookupGroup() {
      if (!groupData) {
        document.getElementById("result").textContent = "Group data is not loaded yet.";
        return;
      }

      const rollInputElement = document.getElementById("rollInput");
      const rollInput = rollInputElement.value.trim().toUpperCase();
      const result = document.getElementById("result");

      if (!rollInput) {
        result.textContent = "Please enter a roll number.";
        return;
      }

      // Feature: Check if the input is a valid group name first.
      if (groupData[rollInput]) {
        const rollsInGroup = groupData[rollInput].join(', ');
        result.textContent = `Group '${rollInput}' contains: ${rollsInGroup}`;
        return; // End the function here if we found a group match.
      }

      const rollAsNumber = parseInt(rollInput, 10);
      const searchKey = isNaN(rollAsNumber) ? rollInput : rollAsNumber;

      let foundGroup = null;
      for (const [group, rolls] of Object.entries(groupData)) {
        if (rolls.includes(searchKey)) {
          foundGroup = group;
          break;
        }
      }

      if (foundGroup) {
        result.textContent = `Roll No. '${rollInput}' belongs to Group: ${foundGroup}`;
      } else {
        result.textContent = `No group or roll number found for '${rollInput}'.`;
      }
    }
  </script>
</body>
</html>